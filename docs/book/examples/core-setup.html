<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Core setup - 3D game reference guide with Rust and Amethyst</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded affix "><a href="../introduction.html">Introduction</a></li><li class="spacer"></li><li class="expanded "><a href="../overview/index.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="expanded "><a href="../infrastructure/index.html"><strong aria-hidden="true">2.</strong> Infrastructure</a></li><li><ol class="section"><li class="expanded "><a href="../infrastructure/programming-languages.html"><strong aria-hidden="true">2.1.</strong> Programming languages</a></li><li class="expanded "><a href="../infrastructure/game-engines.html"><strong aria-hidden="true">2.2.</strong> Game Engines</a></li><li class="expanded "><a href="../infrastructure/entity-component-system.html"><strong aria-hidden="true">2.3.</strong> Entity-Component-System (ECS)</a></li><li class="expanded "><a href="../infrastructure/graphics-api.html"><strong aria-hidden="true">2.4.</strong> Graphics API</a></li></ol></li><li class="expanded "><a href="../window-management/index.html"><strong aria-hidden="true">3.</strong> Window management</a></li><li><ol class="section"><li class="expanded "><a href="../window-management/examples.html"><strong aria-hidden="true">3.1.</strong> Examples</a></li></ol></li><li class="expanded "><a href="../user-interface/index.html"><strong aria-hidden="true">4.</strong> User interface (UI)</a></li><li class="expanded "><a href="../physics/index.html"><strong aria-hidden="true">5.</strong> Physics</a></li><li class="spacer"></li><li class="expanded "><a href="../examples/index.html"><strong aria-hidden="true">6.</strong> Practical examples</a></li><li><ol class="section"><li class="expanded "><a href="../examples/infrastructure.html"><strong aria-hidden="true">6.1.</strong> Infrastructure</a></li><li class="expanded "><a href="../examples/core-setup.html" class="active"><strong aria-hidden="true">6.2.</strong> Core setup</a></li><li class="spacer"></li></ol></li><li class="expanded "><a href="../resources/index.html"><strong aria-hidden="true">7.</strong> Other Resources</a></li><li><ol class="section"><li class="expanded "><a href="../resources/3d-games-resources.html"><strong aria-hidden="true">7.1.</strong> 3D games</a></li><li class="expanded "><a href="../resources/2d-games-resources.html"><strong aria-hidden="true">7.2.</strong> 2D games</a></li><li class="spacer"></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">3D game reference guide with Rust and Amethyst</h1>

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#core-setup-example" id="core-setup-example">Core setup example</a></h1>
<p>This will set up the minimal things required to run a 3d game with Amethyst and Rust.</p>
<ul>
<li>Creating a project</li>
<li>Adding amethyst dependencies</li>
<li>Rendering a basic 3D world with
<ul>
<li>A flat plane</li>
<li>A couple of 3D shapes on that plane</li>
<li>A camera with fixed position and angle looking down on the objects</li>
</ul>
</li>
<li>Basic ui with an fps counter</li>
<li>Generating prefabs</li>
</ul>
<p><img src="/images/examples/core-setup-hero.png" alt="Core setup example" /></p>
<p>The full code example can be found in the <code>code-examples/core-setup-example/</code> folder.
At the end the file structure will look like the following.</p>
<pre><code>core-setup-example/
├─ assets/font/sqaure.ttf
├─ generated/assets/prefabs/ui/ui.ron
├─ src/
│  ├─ bin/prefabs.rs
│  ├─ entities/mod.rs
│  ├─ helpers/
│  │  ├─ mod.rs
│  │  └─ asset_helpers.rs
│  ├─ prefabs/
│  │  ├─ ui/
│  │  │  └─ build_ui_prefabs.rs
│  │  └─ mod.rs
│  ├─ states/mod.rs
│  ├─ systems/
│  │  ├─ mod.rs
│  │  └─ fps_counter_ui_system.rs
│  └─ lib.rs
│  └─ main.rs
├─ target/
├─ Cargo.lock
└─ Cargo.toml
</code></pre>
<h2><a class="header" href="#create-project" id="create-project">Create project</a></h2>
<p>Create (or modify) the <code>Cargo.toml</code> file and add the <code>Amethyst</code> dependencies.
You can use Cargo to create the project with the initial files.</p>
<pre><code class="language-bash">cargo new core-setup-example
</code></pre>
<p>Cargo.toml</p>
<pre><code class="language-toml">[package]
name = &quot;core-setup-example&quot;
version = &quot;0.1.0&quot;
authors = [&quot;Debuglines&quot;]
edition = &quot;2018&quot;

[dependencies.amethyst]
version = &quot;0.13.2&quot;
default-features = false
features = [&quot;vulkan&quot;]

[dependencies]
serde = { version = &quot;1.0&quot;, features = [&quot;derive&quot;] }
ron = &quot;0.5.1&quot;
</code></pre>
<p>We turn <code>default-features</code> off for now to improve compile times.</p>
<h2><a class="header" href="#main-game-function" id="main-game-function">Main game function</a></h2>
<p>We set up the game config in the <code>main.rs</code> file. </p>
<p>We use a few of the included bundles for the core setup. </p>
<ul>
<li>TransformBundle</li>
<li>RenderingBundle, with plugins
<ul>
<li>RenderToWindow</li>
<li>RenderFlat3D</li>
<li>RenderSkybox</li>
<li>RenderUi</li>
</ul>
</li>
<li>InputBundle::<StringBindings></li>
<li>UiBundle::<StringBindings></li>
<li>FpsCounterBundle</li>
</ul>
<p>We also need our own system to update the fps counter on the ui.</p>
<ul>
<li>FpsCounterUiSystem</li>
</ul>
<h2><a class="header" href="#a-simple-game-state" id="a-simple-game-state">A simple game state</a></h2>
<p>We only set up a single state for the core setup, 
and we only need to implement the <code>SimpleState</code>. 
It does not need anything more complex 
as there are only a few things we want it to handle. </p>
<ul>
<li>Spawn the plane and the objects on it</li>
<li>Spawn a camera</li>
<li>Set up the ui</li>
<li>Handle quitting if the <code>esc</code> button is pressed</li>
</ul>
<p>Only the quit action is handled directly in the state,
while the rest is delegated to separate functions. </p>
<h2><a class="header" href="#entities--spawners" id="entities--spawners">Entities / spawners</a></h2>
<p>We have a few spawners and they follow the same general pattern.</p>
<ol>
<li>Initialize components</li>
<li>Create entity with the builder from the world object</li>
<li>Add the components</li>
<li>Build the entity</li>
</ol>
<p>Pseudo code</p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>pub fn spawn_object(world: &amp;mut World) {
    let a = A::new();
    let b = B::new();
    
    world
        .create_entity()
        .with(a)
        .with(b)
        .build();
}
<span class="boring">}
</span></code></pre></pre>
<p>For the object we wan to spawn we need to add three main components.</p>
<ul>
<li>Transform</li>
<li>Mesh</li>
<li>Material</li>
</ul>
<p>The <code>Transform</code> sets the position and rotation of the entity in the game world.</p>
<p>The <code>Mesh</code> sets the shape of the entity. 
We use the built in shape for a plane, cube, sphere and cone. </p>
<p>The <code>Material</code> sets how the mesh is displayed.
We use a built in material with a built in texture. </p>
<p>The <code>Mesh</code>, the <code>Material</code> and the <code>Texture</code> are assets. 
Amethyst provides loaders that will load assets based on data you send in
and we use some very simple ones. 
We also set up a couple of helper functions for our use case, 
which is located in the <code>asset_helpers.rs</code> file. </p>
<h2><a class="header" href="#ui-and-fps-counter" id="ui-and-fps-counter">UI and fps counter</a></h2>
<p>The fps counter works by combining the Amethyst built-in <code>FpsCounterBundle</code>
and our small <code>FpsCounterUiSystem</code>. 
Amethyst also provide example for setting this up. 
The bundle does all of the heavy lifting, 
while the system only update the visual part through the ui.
The only ui we have in this example is a simple ui label widget,
and these widgets are included with Amethyst. </p>
<p>In this example we create the prefab data in the code, serialize it and save it to disk. 
The actual prefabs are then loaded with the <code>UiCreator</code>. 
The gist of this is fairly simple and fit a small function in the <code>prefabs/ui/build_ui_prefbs.rs</code> file.
The <code>prefabs</code> bin entry is responsible for building the ui files.</p>
<h2><a class="header" href="#prefabs" id="prefabs">Prefabs</a></h2>
<p>Prefabs in its simplicity is just text files (or binary)
in a format that Amethyst can load and handle as assets. </p>
<p>The spawners, for example, could have been stored instead as prefabs
and loaded in as assets instead of creating them directly in the code. 
The benefit to doing this is that the compiler will help us 
with any errors we make. </p>
<p>The main benefit with the prefab asset approach is that we can
make any number of changes to the content of the prefabs without having to 
recompile the codebase. 
This can speed up the development when making small changes to tweak the setup.
The other benefit is that its a lot easier to work with Amethyst ui code
when using prefabs than spawning it directly from the code. </p>
<p>However, we do not want to lose the benefit the compiler gives us
so we set up a function that creates the prefab data in code and serialize that.
Instead of creating these prefabs every time we start the game
we add another bin (<code>src/bin/prefabs.rs</code>) that we can run separately. 
Wen using multiple bins like this we also need to create a <code>lib.rs</code> file
that gives us access to the other parts of the code we need. </p>
<p>An example is available below for the <code>lib.rs</code> file. </p>
<pre><pre class="playpen"><code class="language-rust">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>pub mod prefabs;
pub mod helpers;
<span class="boring">}
</span></code></pre></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../examples/infrastructure.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../resources/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../examples/infrastructure.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="../resources/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
